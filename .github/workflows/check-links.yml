name: Check Links

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  check-links:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check for broken links
        run: |
          echo "ğŸ” Checking HTML files for common issues..."
          
          # HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
          echo "ğŸ“„ HTML files found:"
          find . -name "*.html" -type f | grep -v node_modules
          
          # åŸºæœ¬çš„ãªãƒªãƒ³ã‚¯ãƒã‚§ãƒƒã‚¯
          echo ""
          echo "ğŸ”— Checking for broken internal links..."
          
          # hrefã§å‚ç…§ã•ã‚Œã¦ã„ã‚‹HTMLãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
          for html in $(find . -name "*.html" -type f | grep -v node_modules); do
            echo "Checking: $html"
            grep -oP 'href="[^"]+\.html"' "$html" | sed 's/href="//;s/"//' | while read link; do
              # ç›¸å¯¾ãƒ‘ã‚¹ã‚’çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
              dir=$(dirname "$html")
              target=$(realpath -m "$dir/$link" 2>/dev/null || echo "$link")
              
              # ã‚¢ãƒ³ã‚«ãƒ¼ãƒªãƒ³ã‚¯ï¼ˆ#ã§å§‹ã¾ã‚‹ï¼‰ã¯é™¤å¤–
              if [[ ! "$link" =~ ^# ]]; then
                if [ ! -f "$target" ] && [ ! -f "$link" ]; then
                  echo "  âš ï¸  Broken link found: $link in $html"
                fi
              fi
            done
          done
          
          echo ""
          echo "âœ… Link check complete!"
